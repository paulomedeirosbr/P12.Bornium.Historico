unit Bornium.H.Servidor.DTM_Conexao;

//##############################################################################################################################################################
//
//  Objetivo:
//
//##############################################################################################################################################################
//
//  Revisão: xx/xx/xx - Quem - O que?
//
//##############################################################################################################################################################

interface

uses
  System.SysUtils, FireDAC.UI.Intf, FireDAC.VCLUI.Wait, FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Error, FireDAC.Phys.Intf, FireDAC.Stan.Def,
  FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.Phys, FireDAC.Phys.MongoDB, FireDAC.Phys.MongoDBDef, System.Rtti, System.JSON.Types, System.JSON.Readers,
  System.JSON.BSON, System.JSON.Builders, FireDAC.Phys.MongoDBWrapper, Data.DB, FireDAC.Comp.Client, System.Classes, FireDAC.Comp.UI;

type
  TDTM_Conexao = class(TDataModule)
    FDGUIxWaitCursor1: TFDGUIxWaitCursor;
    Conexao: TFDConnection;
    FDPhysMongoDriverLink1: TFDPhysMongoDriverLink;
    procedure DataModuleCreate(Sender: TObject);

  private
    function getEstaConectado: Boolean;


  public

    FCon: TMongoConnection;
    FEnv: TMongoEnv;

    property EstaConectando :Boolean read getEstaConectado;

    class function getInstance :TDTM_Conexao;

    procedure ConexaoAbrir;
    procedure ConexaoFechar;

  end;

implementation

var
  oConexao : TDTM_Conexao;

{$R *.dfm}

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

class function TDTM_Conexao.getInstance: TDTM_Conexao;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  if not Assigned(oConexao) then begin
    oConexao:= TDTM_Conexao.Create(nil);
  end;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  Result:= oConexao;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

function TDTM_Conexao.getEstaConectado: Boolean;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  Result:= Conexao.Connected;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

procedure TDTM_Conexao.ConexaoAbrir;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  try
    Conexao.Connected:= True;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
    if Conexao.Connected then begin
      FCon := TMongoConnection(Conexao.CliObj);
      FEnv := FCon.Env;
    end;
  except
    on E : Exception do begin
      raise Exception.Create(ClassName + '.ConexaoAbrir' + sLineBreak + E.Message);
    end;
  end;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

procedure TDTM_Conexao.ConexaoFechar;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  try
    FCon := nil;
    FEnv := nil;

    Conexao.Connected:= False;
  except
    on E : Exception do begin
      raise Exception.Create(ClassName + '.ConexaoFechar' + sLineBreak + E.Message);
    end;
  end;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;


procedure TDTM_Conexao.DataModuleCreate(Sender: TObject);
begin

end;

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

{
procedure TDTM_Conexao.setDB_Nome(const Value: String);
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  FDB_Nome                := Value;
  Conexao.Connected       := False;
  Conexao.Params.Database := Value;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;
}

{
procedure TDTM_Conexao.setDB_Tabela(const Value: String);
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
   FDB_Tabela := LowerCase(Value);
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;
}

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$


Initialization

Finalization

  if Assigned(oConexao) then begin
    FreeAndNil(oConexao);
  end;

end.
