unit Bornium.Log.DAO_Mongo;

interface

uses
  System.SysUtils, System.Classes, PythonEngine, Vcl.PythonGUIInputOutput;

type
  TDAO_Mongo_ = class(TDataModule)
    PythonEngine: TPythonEngine;
    PythonInputOutput: TPythonInputOutput;
    procedure DataModuleCreate(Sender: TObject);
    procedure DataModuleDestroy(Sender: TObject);
    procedure PythonInputOutputSendData(Sender: TObject; const Data: AnsiString);
  private
    { Private declarations }

    oSisPython  :TStringList;

    RespotaPython :String;

    function L1_ImportModulo:String;
  //   'import pymongo ' + sLineBreak +

    function L2_conexaoMontoDB(AUsuario, ASenha :String) :String;
  // 'client = pymongo.MongoClient("mongodb+srv://borniumadm:axmafraX3324@cluster0.xlelb.mongodb.net/?retryWrites=true&w=majority") '+  sLineBreak +

    function L3_ConectarBancoDados(ANomeBD :String):String;
  // 'a = client.get_database("Bornium") ' +  sLineBreak +

    function L4_ConectarTabela(ANomeTabela :String):String;
  // 'b = a.get_collection("PAIS") ' + sLineBreak +

    function L5_InserirJSon(AJson :String):String;
  // 'x = { ''cdPais'': 121, ''nome'':''paulo cesar medeiros''} '+ sLineBreak +

    function L6_InserirObjeto:String;
  // 'b.insert_one(x) ' + sLineBreak ;

  public

    function ExecutarGet (AScript :String) : String;
    function ExecutarPost(AJson :String) : String;

  end;

implementation

{$R *.dfm}

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

procedure TDAO_Mongo_.DataModuleCreate(Sender: TObject);
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  oSisPython:= TStringList.Create;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

procedure TDAO_Mongo_.DataModuleDestroy(Sender: TObject);
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  FreeAndNil(oSisPython);
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

function TDAO_Mongo_.L1_ImportModulo: String;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  Result:= 'import pymongo ' + sLineBreak;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

function TDAO_Mongo_.L2_ConexaoMontoDB(AUsuario, ASenha :String): String;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  Result:= 'client = pymongo.MongoClient("mongodb+srv://borniumadm:axmafraX3324@cluster0.xlelb.mongodb.net/?retryWrites=true&w=majority") ' + sLineBreak;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

function TDAO_Mongo_.L3_ConectarBancoDados(ANomeBD: String): String;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  Result:= 'a = client.get_database("Bornium") ' + sLineBreak;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

function TDAO_Mongo_.L4_ConectarTabela(ANomeTabela: String): String;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  Result:= 'b = a.get_collection("PAIS") ' + sLineBreak;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

function TDAO_Mongo_.L5_InserirJSon(AJson: String): String;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  Result:= 'x = ' + AJson + ' ' + sLineBreak;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

function TDAO_Mongo_.L6_InserirObjeto: String;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  Result:= 'b.insert_one(x) ' + sLineBreak;
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

procedure TDAO_Mongo_.PythonInputOutputSendData(Sender: TObject; const Data: AnsiString);
begin
  RespotaPython:= RespotaPython + Data;
end;

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

function TDAO_Mongo_.ExecutarGet(AScript :String): String;
var
  Script:String;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  RespotaPython:= '';

  AScript:= UTF8Encode(AScript);

  GetPythonEngine.ExecString(AScript);
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
  Result:= StringReplace(RespotaPython,'''', '"',[rfReplaceAll, rfIgnoreCase]);
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

function TDAO_Mongo_.ExecutarPost(AJson :String): String;
var
  Script:String;
begin
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
   oSisPython.Clear;
   oSisPython.Add(L1_ImportModulo);
   oSisPython.Add(L2_ConexaoMontoDB('',''));
   oSisPython.Add(L3_ConectarBancoDados(''));
   oSisPython.Add(L4_ConectarTabela(''));
   oSisPython.Add(L5_InserirJSon(AJson));
   oSisPython.Add(L6_InserirObjeto);

   Script:= UTF8Encode(oSisPython.Text);

   GetPythonEngine.ExecString(Script);
   Result:= 'Executando POST';
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
end;

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

end.
